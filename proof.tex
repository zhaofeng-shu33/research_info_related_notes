\documentclass{article}
\usepackage{bm}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{url}
\usepackage{amssymb}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\DeclareMathOperator{\E}{\mathbb{E}}
\title{Proofs for semi-supervised SBM}
\begin{document}
\maketitle
\begin{lemma}
Let $Z_{i2}$ follows Bernoulli distribution with parameter $q=\frac{\beta \log n }{n}$.
Let $Z_{i1} \sim Bern(p)$ with $p=\frac{\alpha \log n }{n}$. $Z_{i2}$ are i.i.d. for $i=1,\dots, n$.
The same is true for $Z_{i1}$. $\beta < \alpha$.
We then have $P(\sum_{i=1}^{n} (Z_{i2} - Z_{i1}) \geq  D \log n) \leq n^{-C}$
where $C=\frac{3(\alpha - \beta + D)^2}{2(4\alpha + 2\beta + D)} + O(\log n /n)$.
\end{lemma}
\begin{proof}
	Let $X_i = Z_{i2} - \frac{\beta \log n }{n}, X_{i+n} = \frac{\alpha \log n }{n} - Z_{i1}$.
	$X_i$ are zero means and $|X_i| \leq 1 + O(\frac{\log n}{n})$.
	Then $\sum_{i=1}^{n} (Z_{i2} - Z_{i1}) = \sum_{i=1}^{2n} X_{i} - (\alpha - \beta)\log n $.
	Then $\sum_{i=1}^{n} (Z_{i2} - Z_{i1}) \geq D \log n \iff \sum_{i=1}^{2n} X_{i} \geq (D + \alpha - \beta)\log n$.
	$\sum_{i=1}^{2n} E[X_i^2] = (\alpha + \beta)\log n + O(\frac{\log^2 n}{n})$.
	By Bernstein's inequality, we have
	$$
	P(\sum_{i=1}^{2n} X_{i}  \geq t) \leq \exp(-\frac{1/2 t^2}{\sum_{i=1}^{2n} E[X_i^2] + \frac{1}{3}(1+O(\log n /n))t})
	$$
	Let $t=(D + \alpha - \beta)\log n$.
	\begin{align}
	\frac{1/2 t^2}{\sum_{i=1}^{2n} E[X_i^2] + \frac{1}{3}t} & 
	= \frac{1/2(D + \alpha - \beta)^2\log^2 n}{(\alpha + \beta)\log n + O(\frac{\log^2 n}{n}) + 1/3(D + \alpha - \beta)\log n } \\
	 & =\frac{3/2(D + \alpha - \beta)^2\log n}{O(\frac{\log n}{n}) + (D + 4\alpha - 2\beta) }
	\end{align}
\end{proof}
Notation: $f(n)\dot{=} g(n) \iff \lim_{n\to \infty} \frac{1}{n} \log \frac{f(n)}{g(n)} = 1$.
\begin{lemma}\label{lem:coupled}
	Suppose $k \ll n$. $x_i$ is i.i.d. sampled from $p_1$ and $z_i$ is i.i.d. sampled from $Bern(p)$.
	$p > q$
Let $A := \frac{1}{n}\sum_{i=1}^n \log \frac{p_0(x_i)}{p_1(x_i)} \geq \frac{1}{n} \sum_{i=1}(z_i \log\frac{p}{q} +(1-z_i) \frac{\log(1-p)}{\log(1-q)}))$.
Show that $P(A_k) \dot{=} \exp(-n C)$.
\end{lemma}
\begin{proof}
	To apply Sanov's theorem, we treat $(x_i, z_i)$ jointly sampled from $\mathcal{X} \times \mathcal{Z}$
	and the constraint is 
	\begin{equation}\label{eq:fxz}	
	\frac{1}{n} \sum_{i=1}^n f(x_i, z_i) \geq 0
	\end{equation}	
	where
	$$
	f(x, z) = \log\frac{p_0(x)}{p_1(x)} + z \log\frac{q}{p} + (1-z) \log \frac{1-q}{1-p}
	$$
	Then by Sanov's theorem, we have $C = D(p^*(x,z)|| p_1(x)Bern(p))$
	where $p^*(x,z)$ is the minimizer for $D(p(x,z)|| p_1(x)Bern(p))$ subjected to
	\eqref{eq:fxz}.
	We can rewrite \eqref{eq:fxz} in probability form:
	\begin{equation}\label{eq:probxz}
	\sum_{x\in \mathcal{X}} p(x) \log\frac{p_0(x)}{p_1(x)} + \sum_{z \in \{0,1\}} p(z) \log\frac{p_{Bq}(z)}{p_{Bp}(z)} \geq 0
	\end{equation}
	where $p(x), p(z)$ are the marginal probability mass function.
	Using Lagrange's method, we can get
	\begin{equation}
	p^*(x,z) = C_1 p_0^{\lambda}(x)p_1^{1-\lambda}(x) \cdot C_2 p_{Bq}^{\lambda}(z)p_{Bp}^{1-\lambda}(z)
	\end{equation}
	where $\frac{1}{C_1} = \sum_{x\in\mathcal{X}}p_0^{\lambda}(x)p_1^{1-\lambda}(x) $
	and $\frac{1}{C_2} = \sum_{z\in \{0,1\}} p_{Bq}^{\lambda}(z)p_{Bp}^{1-\lambda}(z)$
	The parameter $\lambda$ is solved by letting the left hand of \eqref{eq:probxz} takes zero.
	That is:
	\begin{equation}\label{eq:constraint}
	C_1 \sum_{x\in \mathcal{X}} p_0^{\lambda}(x)p_1^{1-\lambda}(x)\log\frac{p_0(x)}{p_1(x)} + C_2[p^{1-\lambda}q^{\lambda}\log\frac{q}{p} +
	(1-p)^{1-\lambda}(1-q)^{\lambda}\log\frac{1-q}{1-p} ] = 0
	\end{equation}
	On the other hand,
	\begin{align*}
	C(k) & = D(p(x)|| p_1(x)) + D(p(z) || Bern(p)) \\
	& = C_1\sum_{x\in \mathcal{X}} p_0^{\lambda}(x)p_1^{1-\lambda}(x)\log\frac{C_1  p_0^{\lambda}(x)p_1^{1-\lambda}(x)}{p_1(x)}  \\
	& + C_2[p^{1-\lambda}q^{\lambda}\log\frac{C_2 p^{1-\lambda}q^{\lambda}}{p} +
	(1-p)^{1-\lambda}(1-q)^{\lambda}\log\frac{C_2(1-p)^{1-\lambda}(1-q)^{\lambda}}{(1-p)} ] 
	\end{align*}
	Using \eqref{eq:constraint}, we can simplify $C$ as
	\begin{equation}
	C  =  \log  C_1 + \log C_2
	\end{equation}
	Using $p_0^{\lambda} p_1^{1-\lambda} \leq \lambda p_0 + (1-\lambda) p_1$ we can get $C_1 > 1, C_2 > 1$.

\end{proof}
\begin{corollary}
	Let $p_0 \sim Bern(p), p_1 \sim Bern(q)$ in Lemma \ref{lem:coupled}. Then the region $A$ can be simplified as $\sum_{i=1}^n (x_i - z_i) \geq 0$,
	where $x_i \in Bern(q), z_i \in Bern(p)$ and both are i.i.d. sampled. We can compute $\lambda = \frac{1}{2}$ and the error exponent
	$C = -2\log(\sqrt{pq} + \sqrt{(1-p)(1-q)})$. Below we give another way to prove that $P(A) \dot{=} \exp(-nC)$.
\end{corollary}
\begin{proof}
	We use Chernoff inequality to give a tight upper bound.
	$P(\sum_{i=1}^n (x_i - z_i) \geq 0) \leq \E[\exp(\beta \sum_{i=1}^n (x_i - z_i))]$ where $\beta > 0$.
	$\E[\exp(\beta \sum_{i=1}^n (x_i - z_i))] = (1-q+q e^{\beta})^n(1-p+p e^{-\beta})^n$. Let
	$g(\beta)  = (1-q+q e^{\beta})(1-p+p e^{-\beta})$. $g(0) = 1$ and when $\beta$ is very small,
	$g(\beta) = 1 + (q-p) \beta + o(\beta)$. Therefore, we can choose a proper $\beta$ such that $g(\beta) < 1$.
	Since $\beta$ can take any positive value, now we compute the minimum value of $g(\beta)$ instead.
	the optimal $\beta^*$ satisfies $e^{2\beta} = \frac{(1-q)p}{(1-p)q}$. Now we compute $C' = -\log g(\beta^*) = C$.
	Therefore, $P(A) \leq \exp(-nC)$.
	
	To simplify our discussion, let $X_n = \sum_{i=1}^n X_i, Z_n = \sum_{i=1}^n Z_i$. We have $X_n \sim Binomial(n, q),
	Z_n \sim Binomial(n, p)$ and $X_n, Z_n$ are independent.
	
	On the other hand $P(A) = \sum_{j=1}^n\sum_{k=0}^j P(X_n = j)P(Z_n = k)$.
	We choose a proper $j,k$ such that $P(X_n = j)P(Z_n = k)$ is maximized.
	Since we observe $P(X_n - Z_n = r)$ decreases as $r$ increase ($r\geq 0$).
	The maximum value is taken when $j=k$. On the other hand,
	we should choose:
	$$
	k = n \frac{\sqrt{pq}}{\sqrt{pq} + \sqrt{(1-p)(1-q)}}
	$$
	We have
$$
		P(X_n = k)P(Z_n = k) = \binom{n}{k}^2 p^k (1-p)^{n-k}q^k(1-q)^{n-k}
$$
We will use the inequality $\binom{n}{k} \geq \frac{1}{n+1}\exp(nH(k/n))$.
Then
$$
\log P(X_n = k)P(Z_n = k) \geq -2\log(n+1) + 2n \log(\sqrt{pq} + \sqrt{(1-p)(1-q)})
$$
Therefore, $\log P(A) \geq \log P(X_n = k)P(Z_n = k) \geq -2\log(n+1) + 2n \log(\sqrt{pq} + \sqrt{(1-p)(1-q)})$.
That is $P(A) \geq \frac{1}{(n+1)^2}\exp(-nC)$.
The polynomial term is neglectable compared with the exponential term.
\end{proof}
\end{document}